= simple_form_for(@sale, wrapper: :horizontal_form, html: {class: 'form-horizontal'}) do |f|
  = f.error_notification
  = f.association :warehouse,  disabled: !@sale.new_record?

  - if @sale.new_record?
    %div{:class => ((f.error :customer_id) ? "form-group select required sale_customer has-error": "form-group select required sale_customer")}
      = f.label :customer, class: 'string optional col-sm-3 col-md-2 control-label', for: 'customer_ref', required: true
      = f.input :customer_id, as: :hidden
      %div{:class=>"col-sm-9 col-md-10"}
        %input{:id => 'customer_ref', :ng_model=>"selected", :typeahead_on_select => "type_ahead_customer($item, $model, $label)", :typeahead=>"c.name for c in customer | filter:$viewValue | limitTo:8", :class=>"form-control"}
        = f.error :customer_id

    .form-group
      = f.label :contact_name, :class => "col-sm-3 col-md-2 control-label"
      = f.input :contact_name, as: :hidden, input_html: { value: '{{custref}}'}
      %div{:class=>"col-sm-9 col-md-10"}
        %input{:ng_model=>"custref", :typeahead_on_select => "type_ahead_customer_reference($item, $model, $label)", :typeahead=>"r.name for r in reference | filter:$viewValue | limitTo:8", :class=>"form-control"}
     


  - else
    = f.association :customer, disabled: true
    = f.input :contact_name, disabled: true

  = f.input :contact_email, disabled: !@sale.new_record?
  = f.input :payment_term, as: :select, collection: ['10', '30'], include_blank: false, disabled: !@sale.new_record?, :input_html =>{:class=>'numeric form_control'}
    
  - if @sale.new_record?
    = f.submit class: 'btn btn-primary'
    = link_to 'Back', sales_path, class: 'btn btn-primary'
  - else
    = f.input :state, disabled: true
    - if !@sale.can_edit_items?
      = f.input :approved_at, as: :string, disabled: true
    = f.input :goods_state, disabled: true
    - if @sale.is_delivered?
      = f.input :delivered_at, as: :string, disabled: true
    = f.input :money_state, disabled: true
    - if @sale.is_paid?
      = f.input :paid_at, as: :string, disabled: true

