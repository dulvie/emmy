%div{:ng_controller => "ModalCtrl"}
  = simple_form_for(@production, wrapper: :horizontal_form, html: {class: 'form-horizontal'}) do |f|
    = f.error_notification

    = f.input :description, disabled: !@production.new_record?
    = f.association :our_reference, disabled: !@production.new_record?
    = f.association :warehouse,  disabled: !@production.new_record?

    - if !@production.new_record?

      = f.input :state, disabled: true, :class => 'medium'
      - if !@production.can_edit?
        = f.input :started_at, :as => :string, :input_html => { :class => 'date', :value => localize(f.object.started_at, :format => "%Y-%m-%d"), :readonly => 'readonly'} 
      - if @production.is_completed?
        = f.input :completed_at, :as => :string, :input_html => { :class => 'date', :value => localize(f.object.completed_at, :format => "%Y-%m-%d"), :readonly => 'readonly'} 

      - if @production.product.nil?
        - set_product_url = new_product_path({class:@production.class.name, object:@production.id})
        = render partial: 'shared/addon_plus_link', locals: {form: f, label: :product, link: set_product_url}
        
      - else
        = f.association :product, disabled: true

        .form-group
          .labels_width.control-label
            = f.label :quantity
          .fields_width.form-inline  
            = f.input :quantity, :label=>false, disabled: !@production.can_edit?
      - if @production.completed?
        = f.input :total_amount, disabled: true
        = f.input :cost_price, disabled: true

    .form-button-group
      .actions
        - if @production.can_edit?

          = f.submit class: 'btn btn-primary'

        - if (@production.can_edit_state? && !@production.is_started?) || (@production.can_edit_state? && @production.can_complete?)
          %button{:class=>"btn btn-primary", :ng_click=>"open($event, 'sm','productionContent' )"}
            %span{ :class => "glyphicon glyphicon-flag"}
            = @production.next_event
  %br
  - if !@production.new_record? && !@production.is_completed?
    = render partial: 'shared/modal_state_change', locals: {idx: 'productionContent', model: @production, form_path: state_change_production_path(@production.id), event: @production.next_event, return_path: edit_production_path(@production)}     
  
